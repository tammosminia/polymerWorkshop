<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">

<!--
This gets the weather data for one city using an ajax call and shows it.
-->

<dom-module id="weather-for-city">
    <template>
        <iron-ajax id="getWeather" auto
                   url="http://api.openweathermap.org/data/2.5/weather"
                   params='[[_getParams(city)]]'
                   handle-as="json"
                   on-response="_handleResponse"></iron-ajax>

        [[city]]: <img src="[[_iconUrl]]" width="40px" style="margin-bottom: -15px;"/> [[_description]] [[_degrees]]&deg;C
        <button on-tap="remove">remove</button>
    </template>

    <script>
        Polymer({
            is: 'weather-for-city',

            properties: {
                city: String,
            },

//            ready: function() {
//                this.$.getWeather.generateRequest();
//            },

            _getParams: function() {
                return {
                    q: this.city,
                    appid: "7b9958902d19dac99dd75f203b4275e0",
                    units:"metric"
                };
            },

            _handleResponse: function(event) {
                console.log(event);
                var response = event.detail.response;
                console.log("got weather response : " + response + " for " + response.name);
                this._description = response.weather[0].description;
                this._iconUrl = "http://openweathermap.org/img/w/"+response.weather[0].icon+".png";
                this._degrees = response.main.temp;
            },

            remove: function() {
                this.fire("remove", this.city);
            }

        });

    </script>
</dom-module>
<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-input/iron-input.html">
<link rel="import" href="../paper-toast/paper-toast.html">
<link rel="import" href="location-validator.html">
<link rel="import" href="weather-for-city.html">
<link rel="import" href="shared-styles.html">

<!--
`j-weather`
polymer workshop

@demo demo/index.html 
-->

<dom-module id="j-weather">
<template>
<style include="shared-styles">
:host {
	display: block;
	font-size: 1.4rem;
}

input {
	background-color: #ededed;
    border: 1px solid #b2b2b2;
    padding: 1px 4px;
    border-radius: 2px;
    color: #3c3c3b;
    font-size: 1.2rem;
    height: 2rem;
}

h2, h3, ul {
	margin: 0.5rem 0; 
}

h2, h3 {
	color: #2dcd4d;
}

.validationError {
	font-size: 1rem;
    color: #e85c41;
    margin-top: 0.2rem;
}

ul {
	list-style: none;
	padding-left: 0;
}
</style>
<h2>J-weather</h2>

<form id="form" is="iron-form" on-submit="addLocation">
	<div>
		<input is="iron-input" name="location" required autofocus
		bind-value="{{newLocation}}" autocomplete="off">
		<button id="submit" type="submit">Add</button>
	</div>
	<div class="validationError" hidden$="{{_iscityfound}}">Could not find city: "[[_city]]"</div>
</form>

<h3>Interesting locations</h3>
<ul>
	<template is="dom-repeat" items="[[locations]]" index-as="index">
	<li>
		<weather-for-city city="[[item]]" on-notfound="notFound" on-remove="removeLocation"></weather-for-city>
	</li>
	</template>
</ul>

<paper-toast id="toast" text="location removed"></paper-toast>
</template>
<script>
	Polymer({
		is : 'j-weather',

		properties : {
			newLocation : String,

			locations : {
				type : Array,
				value : function() {
					return [ "Amsterdam" ]
				}
			},
			
			_iscityfound: {
                type: Boolean,
                value: true
            }
		},
		
		addLocation: function (e) {
			e.preventDefault();
			this._iscityfound = true;
		    console.log("adding " + this.newLocation);
		    this.push("locations", this.newLocation); //use the Polymer push function, otherwise databinding won't be noticed
		    this.newLocation = "";
		    console.log(this.locations);
		},

		removeLocation : function(event) {
			var location = this._removeLocation(event);
			this.$.toast.text = location + " removed";
			this.$.toast.open();
		},
		
		_removeLocation: function(event) {
			var location = event.detail;
			console.log("got remove event for " + location);
			var index = this.locations.indexOf(location);
			console.log("removing index " + index);
			this.splice('locations', index, 1);
			return location;
		},
		
		notFound: function(event) {
			console.log("not found");
			this._removeLocation(event);
			this._city = event.detail;
			this._iscityfound = false;
		}

	});
</script>
</dom-module>
